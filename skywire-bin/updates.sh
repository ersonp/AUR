#!/bin/bash
#re-archive the scripts and update the checksums, etc.
#tar -czvf skywire-deb-scripts.tar.gz skywire-deb-scripts
tar -czvf skywire-scripts.tar.gz skywire-scripts
#reset the pkgver to autogenerated
_version=$(git ls-remote --tags --refs --sort="version:refname" https://github.com/skycoin/skywire.git | tail -n1)
_version=${_version##*/}
_version=${_version%%-*}
_version=${_version//v/}
_vrc=$(git ls-remote --tags --refs --sort="version:refname" https://github.com/skycoin/skywire.git | tail -n1 | grep -- -rc)
if [[ _vrc != "" ]]; then
	_vrc="-${_vrc##*-}"
fi
echo ${_version}
echo ${_vrc}
sed -i "s/\npkgver=.*/\npkgver='${_version}'/" PKGBUILD
sed -i "s/\n_rc=.*/\n_rc='${_vrc}'/" PKGBUILD
sed -i "s/\npkgver=.*/\npkgver='${_version}'/" cc.deb.PKGBUILD
sed -i "s/\n_rc=.*/\n_rc='${_vrc}'/" cc.deb.PKGBUILD
updpkgsums
updpkgsums cc.deb.PKGBUILD
makepkg --printsrcinfo > .SRCINFO
echo "don't forget to increment pkgrel if you edited the PKGBUILD"
echo "git add -f cc.deb.PKGBUILD PKGBUILD .SRCINFO skywire-scripts.tar.gz" # skywire-deb-scripts.tar.gz"
